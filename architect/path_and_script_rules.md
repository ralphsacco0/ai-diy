# Path and Script Rules for Generated Apps

This document defines the mandatory patterns for all code generated by Mike (Sprint Execution) and validated by Alex (Sprint Review).

## Overview

Generated apps run behind a Caddy reverse proxy at `/yourapp/`. This requires specific path handling rules to work correctly both locally and in production.

---

## Rule 1: Script Tag Inclusion

**Every HTML file that has a corresponding JavaScript file MUST include a script tag.**

### Pattern
```html
<!-- At the end of the HTML file, before </body> -->
<script src="filename.js"></script>
</body>
</html>
```

### Examples
| HTML File | Required Script Tag |
|-----------|---------------------|
| `public/login.html` | `<script src="login.js"></script>` |
| `public/dashboard.html` | `<script src="dashboard.js"></script>` |
| `public/employees.html` | `<script src="employees.js"></script>` |

### Why This Matters
Without the script tag:
- Forms POST directly and show raw JSON responses
- No JavaScript event handlers are attached
- Pages are static with no interactivity

---

## Rule 2: Path Styles by Location

| Code Location | Path Style | Leading Slash |
|---------------|------------|---------------|
| Server-side (Express routes, redirects) | Absolute | YES `/` |
| Client-side (HTML, browser JS) | Relative | NO |

---

## Rule 3: Server-Side Paths (Express/Node.js)

**Always use absolute paths with leading `/`**

```
✅ res.redirect('/dashboard')    ❌ res.redirect('dashboard')
✅ res.redirect('/login')        ❌ res.redirect('login')
✅ router.get('/login', ...)     (route definitions always absolute)
✅ router.post('/api/auth', ...) (API routes always absolute)
✅ app.use('/api', apiRouter)
```

---

## Rule 4: Client-Side Paths (HTML Files)

**Always use relative paths WITHOUT leading `/`**

```
✅ href="dashboard"              ❌ href="/dashboard"
✅ href="logout"                 ❌ href="/logout"
✅ href="css/styles.css"         ❌ href="/css/styles.css"
✅ src="login.js"                ❌ src="/login.js"
✅ action="api/auth/login"       ❌ action="/api/auth/login"
```

---

## Rule 5: Client-Side Paths (JavaScript Files)

**Always use relative paths WITHOUT leading `/`**

```
✅ fetch('api/user')                         ❌ fetch('/api/user')
✅ fetch('api/auth/login')                   ❌ fetch('/api/auth/login')
✅ window.location.href = 'dashboard'        ❌ window.location.href = '/dashboard'
✅ window.location.href = 'login'            ❌ window.location.href = '/login'
```

---

## Why This Works

When the app runs at `/yourapp/`:

**Relative paths resolve correctly:**
```
Current URL: /yourapp/dashboard
href="logout"         → /yourapp/logout         ✅
href="css/styles.css" → /yourapp/css/styles.css ✅
fetch('api/user')     → /yourapp/api/user       ✅
```

**Absolute paths go to wrong location:**
```
Current URL: /yourapp/dashboard
href="/logout"        → /logout             ❌ (wrong server)
href="/css/styles.css"→ /css/styles.css     ❌ (404)
fetch('/api/user')    → /api/user           ❌ (404)
```

---

## Form Handling Pattern

For forms that submit to an API and handle JSON responses:

### HTML (login.html)
```html
<form id="loginForm" action="api/auth/login" method="post">
    <input type="email" name="email" required>
    <input type="password" name="password" required>
    <button type="submit">Log In</button>
</form>
<script src="login.js"></script>
</body>
```

### JavaScript (login.js)
```javascript
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);

    const response = await fetch('api/auth/login', {  // Relative path
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });

    const result = await response.json();

    if (result.success) {
        window.location.href = 'dashboard';  // Relative path
    } else {
        // Show error
    }
});
```

---

## Checklist for Code Generation

Before completing any HTML file:
- [ ] Script tag included for corresponding JS file
- [ ] All `href` attributes use relative paths (no leading `/`)
- [ ] All `src` attributes use relative paths (no leading `/`)
- [ ] All `action` attributes use relative paths (no leading `/`)

Before completing any client-side JS file:
- [ ] All `fetch()` URLs use relative paths (no leading `/`)
- [ ] All `window.location.href` assignments use relative paths (no leading `/`)

Before completing any server-side JS file:
- [ ] All `router.get/post/put/delete` use absolute paths (with leading `/`)
- [ ] All `res.redirect()` use absolute paths (with leading `/`)

---

## Quick Reference

```
SERVER-SIDE (keep the /)     CLIENT-SIDE (remove the /)
========================     ==========================
res.redirect('/dashboard')   href="dashboard"
router.get('/login')         src="login.js"
router.post('/api/auth')     fetch('api/auth')
app.use('/api')              window.location.href = 'login'
```
