{
  "project_name": "BrightHR_Lite_Vision",
  "architecture_locked": true,
  "locked_at_sprint": "SP-001",
  "conventions": {
    "module_system": "es6",
    "database": {
      "entry_point": "src/db.js",
      "factory_function": "createDb",
      "init_function": "initDb",
      "test_mode": ":memory:",
      "prod_db_path": "./data.sqlite"
    },
    "auth": {
      "method": "express-session",
      "session_config": {
        "secret": "process.env.SESSION_SECRET || 'fallback-secret-do-not-use-in-prod'",
        "cookie_maxAge": 1800000,
        "cookie_maxAge_description": "30 minutes",
        "resave": false,
        "saveUninitialized": false,
        "cookie": {
          "httpOnly": true,
          "secure": false,
          "sameSite": "lax"
        }
      },
      "password_field": "password_hash",
      "hash_method": "await bcrypt.hash(plaintext, 10)",
      "compare_method": "await bcrypt.compare(input, hash)",
      "testing": "Session must persist across requests; verify with sequential fetch calls; session destroyed on logout",
      "session_user_keys": [
        "id",
        "name",
        "email",
        "role"
      ],
      "role_values": [
        "hr",
        "employee"
      ]
    },
    "exports": {
      "pattern": "named",
      "example": "export { createDb } from './db.js'"
    },
    "api_patterns": {
      "error_handling": "try/catch blocks in all async functions",
      "async_pattern": "async/await for all database operations and route handlers",
      "response_format": "res.status(code).json({ success: true/false, data: {}, error: {} }) for API; res.redirect(path) or res.render/sendFile for pages",
      "middleware_order": "express.json(), session middleware, static('public'), routes, error handler"
    },
    "server": {
      "entry_point": "src/server.js",
      "export": "app (Express instance)",
      "auto_start": false,
      "start_condition": "if (import.meta.url === `file://${process.argv[1]}`) { app.listen(port, () => console.log(`Server on port ${port}`)); }",
      "testing": "Import { app } from '../src/server.js'; then app.listen(0) in tests"
    },
    "file_structure": {
      "src/db.js": "Database factory and init",
      "src/server.js": "Express app setup",
      "src/routes/": "Route files (e.g., auth.js, employees.js)",
      "src/controllers/": "Handler functions",
      "src/middleware/": "Custom middleware (e.g., auth.js, rbac.js)",
      "public/": "Static files: index.html, css/, js/",
      "public/css/": "Stylesheets",
      "public/js/": "Client-side JS",
      "tests/": "Auto-generated by QA",
      "package.json": "Dependencies and scripts",
      ".env": "Environment variables",
      "README.md": "Setup instructions",
      ".gitignore": "Ignore .env, data.sqlite, node_modules"
    },
    "environment": {
      "dotenv": "import 'dotenv/config'; at top of server.js",
      "vars": {
        "PORT": "3000",
        "DB_PATH": "./data.sqlite",
        "SESSION_SECRET": "fallback-secret-do-not-use-in-prod"
      },
      "fallback": "process.env.PORT || 3000"
    },
    "database_patterns": {
      "seeding": "In initDb: Check if users table empty, then insert seed data",
      "test_isolation": "If process.env.NODE_ENV === 'test', use ':memory:'",
      "cleanup": "db.close() in finally blocks",
      "async_wrapper": "new Promise((resolve, reject) => { db.run(sql, params, function(err) { if (err) reject(err); else resolve(this); }); })"
    }
  },
  "current_schema": {
    "users": {
      "fields": [
        {
          "name": "id",
          "type": "INTEGER PRIMARY KEY AUTOINCREMENT"
        },
        {
          "name": "name",
          "type": "TEXT NOT NULL"
        },
        {
          "name": "email",
          "type": "TEXT UNIQUE NOT NULL"
        },
        {
          "name": "password_hash",
          "type": "TEXT NOT NULL"
        },
        {
          "name": "role",
          "type": "TEXT DEFAULT 'employee'"
        },
        {
          "name": "start_date",
          "type": "TEXT"
        }
      ],
      "added_in": "NFR-001"
    }
  },
  "current_endpoints": [
    {
      "method": "POST",
      "path": "/login",
      "request": "application/x-www-form-urlencoded {email, password}",
      "response": "302 redirect to /dashboard on success, 302 to /login?error=invalid on failure",
      "added_in": "US-009",
      "modified_in": "US-999",
      "changes": "After successful authentication, redirect to /dashboard instead of previous path"
    },
    {
      "method": "GET",
      "path": "/logout",
      "request": null,
      "response": "302 redirect to /login after session destroy",
      "added_in": "US-009"
    },
    {
      "method": "GET",
      "path": "/",
      "request": null,
      "response": "Serve public/login.html if no session, redirect to /dashboard if authenticated",
      "added_in": "US-009"
    },
    {
      "method": "GET",
      "path": "/api/user",
      "request": "None (uses session)",
      "response": "{success: true, data: {id, name, email, role}} or {success: false, error: 'Unauthorized'}",
      "added_in": "US-999"
    }
  ],
  "last_updated": "2025-12-12T15:07:33.956219",
  "tech_stack": {
    "backend": "nodejs_express",
    "frontend": "plain_html_css_js",
    "database": "sqlite",
    "backend_port": "3000",
    "frontend_port": "3000"
  },
  "todos": [
    {
      "id": "TODO-001",
      "description": "Implement full functionality in stub pages: employee-directory.html (US-001 Employee Directory Search), leave-approvals.html (US-005 Approve Leave Request), documents.html (US-008 View Employee Documents), my-leaves.html (US-010 View Own Leave Requests), update-profile.html (US-011 Employee Self-Service Profile Update)",
      "file": "public/employee-directory.html, public/leave-approvals.html, public/documents.html, public/my-leaves.html, public/update-profile.html",
      "created_in": "US-999",
      "status": "pending",
      "priority": "medium",
      "created_at": "2025-12-12T15:07:33.957998"
    }
  ]
}